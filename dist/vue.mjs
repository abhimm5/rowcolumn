import{defineComponent as _,h as H,ref as V,onMounted as U,onUpdated as B,onUnmounted as q}from"vue";function O(e){return{t:e.top||0,r:e.right||0,b:e.bottom||0,l:e.left||0}}function k(e,t,s){if(e instanceof x||typeof e!="object"||e===null)return e;let n=e,a=Object.keys(n).sort((o,d)=>(s[d]||0)-(s[o]||0));for(let o of a)if(t>=(s[o]||0))return n[o];return n.xs??n.default??1}function j(e,t){if(!t)return;let{className:s,class:n,...a}=t;s&&e.classList.add(...String(s).split(" ")),n&&e.classList.add(...String(n).split(" ")),Object.assign(e.style,a)}var x=class e{constructor(t,s="leaf",n=[]){this.size=t;this.type=s;this.children=n;this.isSkippedSelf=!1;this.offsetIndices=[];this.styles={};this.spanData={t:0,r:0,b:0,l:0};this.childPropRules=[];this.childSpanRules=[]}col(...t){return new e(this.size,"col",t)}row(...t){return new e(this.size,"row",t)}offset(t){return Array.isArray(t)?this.offsetIndices=t:this.isSkippedSelf=!0,this}props(t){return this.styles={...this.styles,...t},this}childProps(t,s){return this.childPropRules.push({data:t,indices:s||null}),this}span(t,s){let n=O(t);return s?this.childSpanRules.push({data:n,indices:s}):(this.spanData.t+=n.t,this.spanData.r+=n.r,this.spanData.b+=n.b,this.spanData.l+=n.l),this}},z=class{constructor(t,s,n,a,o,d,b,m={t:0,r:0,b:0,l:0}){this.x=t;this.y=s;this.w=n;this.h=a;this.styles=o;this.isSkipped=d;this.customSize=b;this.spanData=m}},C=!1;function $(){if(C)return;C=!0;let e=(t,s=!1)=>{if(t.col)return;let n=a=>new x(s?String(a):a);t.col=function(...a){return new x(s?String(this):this,"col",a)},t.row=function(...a){return new x(s?String(this):this,"row",a)},t.offset=function(a){return n(this).offset(a)},t.props=function(a){return n(this).props(a)},t.childProps=function(a,o){return n(this).childProps(a,o)},t.span=function(a,o){return n(this).span(a,o)}};e(Number.prototype,!1),e(String.prototype,!0)}var P={bps:{xs:0,sm:576,md:768,lg:992,xl:1200,xxl:1400},_strMap:new Map,_strCounter:0,init(){$(),this.upd(),typeof window<"u"&&window.addEventListener("resize",()=>this.upd())},upd(){typeof document<"u"&&document.querySelectorAll("[layout]").forEach(e=>this.render(e))},evalLayout(e){if(e)try{return new Function("lg","sm","Grid","auto","none","return "+e)(61.8,38.2,100,"auto","none")}catch{return}},isNode(e){return e&&typeof e=="object"&&Array.isArray(e.children)},render(e,t){$();let s=typeof window<"u"?window.innerWidth:0,n=t;if(!n){let i=s>=1400&&e.getAttribute("layout-xxl")||s>=1200&&e.getAttribute("layout-xl")||s>=992&&e.getAttribute("layout-lg")||s>=768&&e.getAttribute("layout-md")||s>=576&&e.getAttribute("layout-sm")||e.getAttribute("layout");i&&(n=this.evalLayout(i))}if(!n)return;j(e,n.styles);let a=[];this.calc(n,0,0,100,100,a,!1,[],[],[],{val:0},s,{t:0,r:0,b:0,l:0});let{cw:o,rh:d,xc:b,yc:m}=this.mesh(a);e.style.display="grid",e.style.gridTemplateColumns=o.join(" "),e.style.gridTemplateRows=d.join(" ");let p=Array.from(e.children);p.forEach(i=>{i.style.gridArea="",i.style.display=""});let u=0;a.forEach(i=>{if(i.isSkipped)return;let f=p[u++];if(!f)return;if(i.styles?.display==="none"){f.style.display="none";return}let h=this.idx(b,i.x)+1,r=this.idx(b,i.x+i.w)+1,S=this.idx(m,i.y)+1,L=this.idx(m,i.y+i.h)+1;i.spanData&&(h=Math.max(1,h-i.spanData.l),S=Math.max(1,S-i.spanData.t),r+=i.spanData.r,L+=i.spanData.b),f.style.gridColumn=`${h} / ${r}`,f.style.gridRow=`${S} / ${L}`,j(f,i.styles)})},calc(e,t,s,n,a,o,d,b,m,p,u,i,f){if(e==null)return;let h=k(e,i,this.bps),r;this.isNode(h)?(r=h,r.size=k(r.size,i,this.bps)):r=new x(h,"leaf");let S=this.isNode(r),L=d||r.isSkippedSelf,T=[...b];S&&r.offsetIndices?.length&&T.push({idx:r.offsetIndices,c:0});let w={...f};S&&(w.t+=r.spanData.t,w.r+=r.spanData.r,w.b+=r.spanData.b,w.l+=r.spanData.l);let N=[...m],M=[...p];if(r.childPropRules.length&&r.childPropRules.forEach(l=>N.push({rule:l,counter:{val:0}})),r.childSpanRules.length&&r.childSpanRules.forEach(l=>M.push({rule:l,counter:{val:0}})),r.type==="leaf"||!r.children.length){let l=L;T.forEach(c=>{c.c++,c.idx.includes(c.c)&&(l=!0)}),l||(u.val++,N.forEach(c=>c.counter.val++),M.forEach(c=>c.counter.val++));let y={...w};l||M.forEach(c=>{(!c.rule.indices||c.rule.indices.includes(c.counter.val))&&(y.t+=c.rule.data.t,y.r+=c.rule.data.r,y.b+=c.rule.data.b,y.l+=c.rule.data.l)});let g={...r.styles};r.size==="none"&&(g.display="none"),l||N.forEach(c=>{(!c.rule.indices||c.rule.indices.includes(c.counter.val))&&Object.assign(g,c.rule.data)}),o.push(new z(t,s,n,a,g,l,typeof r.size=="string"?r.size:void 0,y));return}let D=0,I=r.children.map(l=>{let y=k(l,i,this.bps);return this.isNode(y)&&(y.size=k(y.size,i,this.bps)),y});I.forEach(l=>{let y=this.isNode(l)?l.size:l;y==="none"||typeof y=="string"?y=0:this.isNode(l)&&l.size===0&&(y=1),D+=Number(y)}),D===0&&(D=1);let v=r.type==="col"?t:s;I.forEach(l=>{let y=this.isNode(l)?l.size:l,g=typeof y=="string",c=g?0:Number(y);this.isNode(l)&&l.size===0&&!g&&(c=1);let A=c/D,E=0;if(g&&y!=="none"&&(this._strCounter++,E=1e-6+this._strCounter*1e-7,this._strMap.set(E.toFixed(9),y)),r.type==="col"){let R=g?E:n*A;this.calc(l,v,s,R,a,o,L,T,N,M,u,i,{t:0,r:0,b:0,l:0}),v+=R}else{let R=g?E:a*A;this.calc(l,t,v,n,R,o,L,T,N,M,u,i,{t:0,r:0,b:0,l:0}),v+=R}})},mesh(e){this._strCounter=0;let t=[0],s=[0],n=0,a=0;e.forEach(p=>{t.push(p.x,p.x+p.w),s.push(p.y,p.y+p.h),n=Math.max(n,p.x+p.w),a=Math.max(a,p.y+p.h)}),n>1&&t.push(100),a>1&&s.push(100);let o=p=>[...new Set(p.sort((u,i)=>u-i))].filter((u,i,f)=>i===0||Math.abs(u-f[i-1])>1e-8),d=o(t),b=o(s),m=p=>{let u=[];for(let i=1;i<p.length;i++){let f=p[i]-p[i-1],h=null;for(let[r,S]of this._strMap)if(Math.abs(f-Number(r))<1e-8){h=S;break}u.push(h||f/10+"fr")}return u};return{xc:d,yc:b,cw:m(d),rh:m(b)}},idx(e,t){let s=-1,n=1/0;return e.forEach((a,o)=>{let d=Math.abs(a-t);d<n&&(n=d,s=o)}),s},compileCSS(e){let t=this.evalLayout(e);if(!t)return null;let s=[];this.calc(t,0,0,100,100,s,!1,[],[],[],{val:0},1200,{t:0,r:0,b:0,l:0});let{cw:n,rh:a,xc:o,yc:d}=this.mesh(s),b=`display: grid; grid-template-columns: ${n.join(" ")}; grid-template-rows: ${a.join(" ")};`,m="",p=1;for(let u of s){if(u.isSkipped)continue;let i=this.idx(o,u.x)+1,f=this.idx(o,u.x+u.w)+1,h=this.idx(d,u.y)+1,r=this.idx(d,u.y+u.h)+1;u.spanData&&(i=Math.max(1,i-u.spanData.l),h=Math.max(1,h-u.spanData.t),f+=u.spanData.r,r+=u.spanData.b),m+=`
  & > :nth-child(${p++}) { grid-area: ${h} / ${i} / ${r} / ${f};${u.styles?.display==="none"?" display: none;":""} }`}return b+m}};var J=_({name:"Layout",props:{layout:{type:[String,Object],required:!0},"layout-sm":{type:[String,Object]},"layout-md":{type:[String,Object]},"layout-lg":{type:[String,Object]}},setup(e,{slots:t,attrs:s}){let n=V(null),a=()=>{if(n.value){let o=window.innerWidth,d;o>=992&&typeof e["layout-lg"]=="object"?d=e["layout-lg"]:o>=768&&typeof e["layout-md"]=="object"?d=e["layout-md"]:o>=576&&typeof e["layout-sm"]=="object"?d=e["layout-sm"]:typeof e.layout=="object"&&(d=e.layout),P.render(n.value,d)}};return U(()=>{a(),window.addEventListener("resize",a)}),B(()=>a()),q(()=>window.removeEventListener("resize",a)),()=>{let o={...s};return typeof e.layout=="string"&&(o.layout=e.layout),typeof e["layout-sm"]=="string"&&(o["layout-sm"]=e["layout-sm"]),H("div",{ref:n,style:{display:"grid",width:"100%",height:"100%"},...o},t.default?t.default():[])}}});export{J as Layout};
