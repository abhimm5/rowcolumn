import{defineComponent as $,h as k,ref as C,onMounted as I,onUpdated as O,onUnmounted as P}from"vue";function A(e){let i={t:0,r:0,b:0,l:0};return e.forEach(s=>{let r=s.match(/^([trbl])(\d+)$/);r&&(i[r[1]]+=parseInt(r[2],10))}),i}var N=class e{constructor(i,s="leaf",r=[]){this.size=i;this.type=s;this.children=r;this.isSkippedSelf=!1;this.offsetIndices=[];this.styles={};this.spreadData={t:0,r:0,b:0,l:0};this.childPropRules=[];this.childSpreadRules=[]}col(...i){return new e(this.size,"col",i)}row(...i){return new e(this.size,"row",i)}offset(i){return Array.isArray(i)?this.offsetIndices=i:this.isSkippedSelf=!0,this}props(i){return this.styles={...this.styles,...i},this}childProps(i,s){return this.childPropRules.push({data:i,indices:s||null}),this}spread(i,s){let r=A(i);return s?this.childSpreadRules.push({data:r,indices:s}):(this.spreadData.t+=r.t,this.spreadData.r+=r.r,this.spreadData.b+=r.b,this.spreadData.l+=r.l),this}},D=class{constructor(i,s,r,u,a,d,b,h={t:0,r:0,b:0,l:0}){this.x=i;this.y=s;this.w=r;this.h=u;this.styles=a;this.isSkipped=d;this.customSize=b;this.spreadData=h}},T=!1;function j(){if(T)return;T=!0;let e=s=>new N(s),i=(s,r=!1)=>{if(s.col)return;let u=a=>e(r?String(a):a);s.col=function(...a){return new N(r?String(this):this,"col",a)},s.row=function(...a){return new N(r?String(this):this,"row",a)},s.offset=function(a){return u(this).offset(a)},s.props=function(a){return u(this).props(a)},s.childProps=function(a,d){return u(this).childProps(a,d)},s.spread=function(a,d){return u(this).spread(a,d)}};i(Number.prototype,!1),i(String.prototype,!0)}var z={bps:{sm:576,md:768,lg:992,xl:1200,xxl:1400},_strMap:new Map,_strCounter:0,init(){j(),this.upd(),typeof window<"u"&&window.addEventListener("resize",()=>this.upd())},upd(){typeof document<"u"&&document.querySelectorAll("[layout]").forEach(e=>this.render(e))},evalLayout(e){if(e)try{return new Function("lg","sm","Grid","auto","return "+e)(61.8,38.2,100,"auto")}catch(i){console.error(`Layout Error: "${e}"`,i);return}},isNode(e){return e&&typeof e=="object"&&Array.isArray(e.children)&&(e.type==="col"||e.type==="row"||e.type==="leaf")},render(e,i){j();let s=i;if(!s){let t=window.innerWidth,n=["xxl","xl","lg","md","sm"],f=e.getAttribute("layout");for(let c of n)if(t>=this.bps[c]&&e.hasAttribute(`layout-${c}`)){f=e.getAttribute(`layout-${c}`);break}f&&(s=this.evalLayout(f))}if(!s)return;if(s.styles){let{className:t,class:n,...f}=s.styles;t&&e.classList.add(...t.split(" ")),n&&e.classList.add(...n.split(" ")),Object.assign(e.style,f)}let r=[];this.calc(s,0,0,100,100,r,!1,[],[],[],{val:0});let{cw:u,rh:a,xc:d,yc:b}=this.mesh(r);e.style.display="grid",e.style.gridTemplateColumns=u.join(" "),e.style.gridTemplateRows=a.join(" ");let h=Array.from(e.children);h.forEach((t,n)=>{t.style.gridColumn="",t.style.gridRow="",t.style.cssText=""});let l=0;r.forEach(t=>{if(t.isSkipped||!h[l])return;let n=h[l++],f=this.idx(d,t.x)+1,c=this.idx(d,t.x+t.w)+1,p=this.idx(b,t.y)+1,g=this.idx(b,t.y+t.h)+1;if(t.spreadData&&(f=Math.max(1,f-t.spreadData.l),p=Math.max(1,p-t.spreadData.t),c+=t.spreadData.r,g+=t.spreadData.b),n.style.gridColumn=`${f} / ${c}`,n.style.gridRow=`${p} / ${g}`,t.styles){let{className:x,class:w,...S}=t.styles;x&&n.classList.add(...x.split(" ")),w&&n.classList.add(...w.split(" ")),Object.assign(n.style,S)}})},calc(e,i,s,r,u,a,d,b,h,l,t){if(!e)return;(typeof e=="number"||e==="auto")&&(e=new N(e==="auto"?"auto":e,"leaf"));let n=this.isNode(e),f=d||n&&e.isSkippedSelf,c=[...b],p=[...h],g=[...l];n&&(e.offsetIndices?.length&&c.push({idx:e.offsetIndices,c:0}),e.childPropRules.length&&e.childPropRules.forEach(y=>p.push({rule:y,counter:{val:0}})),e.childSpreadRules.length&&e.childSpreadRules.forEach(y=>g.push({rule:y,counter:{val:0}})));let x;if(n&&typeof e.size=="string"&&(x=e.size),!n||!e.children.length){let y=f;for(let o=0;o<c.length;o++)c[o].c++,c[o].idx.includes(c[o].c)&&(y=!0);y||(t.val++,p.forEach(o=>o.counter.val++),g.forEach(o=>o.counter.val++));let m=n?{...e.spreadData}:{t:0,r:0,b:0,l:0},L=n?{...e.styles}:{};y||(g.forEach(o=>{(!o.rule.indices||o.rule.indices.includes(o.counter.val))&&(m.t+=o.rule.data.t,m.r+=o.rule.data.r,m.b+=o.rule.data.b,m.l+=o.rule.data.l)}),p.forEach(o=>{(!o.rule.indices||o.rule.indices.includes(o.counter.val))&&Object.assign(L,o.rule.data)})),a.push(new D(i,s,r,u,L,y,x,m));return}let w=0;e.children.forEach(y=>{let m=this.isNode(y)?y.size:y;typeof m=="string"?m=0:this.isNode(y)&&y.size===0&&(m=1),w+=Number(m)}),w===0&&(w=1);let S=e.type==="col"?i:s;e.children.forEach((y,m)=>{let L=this.isNode(y)?y.size:y,o=typeof L=="string",R=o?0:Number(L);this.isNode(y)&&y.size===0&&!o&&(R=1);let M=R/w,v=0;if(o&&(this._strCounter++,v=1e-6+this._strCounter*1e-7,this._strMap.set(v.toFixed(9),L)),e.type==="col"){let E=o?v:r*M;this.calc(y,S,s,E,u,a,f,c,p,g,t),S+=E}else{let E=o?v:u*M;this.calc(y,i,S,r,E,a,f,c,p,g,t),S+=E}})},mesh(e){this._strCounter=0;let i=[0],s=[0],r=0,u=0;e.forEach(l=>{i.push(l.x,l.x+l.w),s.push(l.y,l.y+l.h),l.x+l.w>r&&(r=l.x+l.w),l.y+l.h>u&&(u=l.y+l.h)}),r>1&&i.push(100),u>1&&s.push(100);let a=l=>[...new Set(l.sort((t,n)=>t-n))].filter((t,n,f)=>n===0||Math.abs(t-f[n-1])>1e-8),d=a(i),b=a(s),h=l=>{let t=[];for(let n=1;n<l.length;n++){let f=l[n]-l[n-1],c=null;for(let[p,g]of this._strMap){let x=Number(p);if(Math.abs(f-x)<1e-8){c=g;break}}t.push(c||f+"fr")}return t};return{xc:d,yc:b,cw:h(d),rh:h(b)}},idx(e,i){let s=-1,r=1/0;return e.forEach((u,a)=>{let d=Math.abs(u-i);d<r&&(r=d,s=a)}),s},compileCSS(e){let i=this.evalLayout(e);if(!i)return null;let s=[];this.calc(i,0,0,100,100,s,!1,[],[],[],{val:0});let{cw:r,rh:u,xc:a,yc:d}=this.mesh(s),b=`display: grid; grid-template-columns: ${r.join(" ")}; grid-template-rows: ${u.join(" ")};`,h="",l=1;for(let t of s){if(t.isSkipped)continue;let n=this.idx(a,t.x)+1,f=this.idx(a,t.x+t.w)+1,c=this.idx(d,t.y)+1,p=this.idx(d,t.y+t.h)+1;t.spreadData&&(n=Math.max(1,n-t.spreadData.l),c=Math.max(1,c-t.spreadData.t),f+=t.spreadData.r,p+=t.spreadData.b),h+=`
  & > :nth-child(${l++}) { grid-area: ${c} / ${n} / ${p} / ${f}; }`}return b+h}};var F=$({name:"Layout",props:{layout:{type:[String,Object],required:!0},"layout-sm":{type:[String,Object]},"layout-md":{type:[String,Object]},"layout-lg":{type:[String,Object]}},setup(e,{slots:i,attrs:s}){let r=C(null),u=()=>{if(r.value){let a=window.innerWidth,d;a>=992&&typeof e["layout-lg"]=="object"?d=e["layout-lg"]:a>=768&&typeof e["layout-md"]=="object"?d=e["layout-md"]:a>=576&&typeof e["layout-sm"]=="object"?d=e["layout-sm"]:typeof e.layout=="object"&&(d=e.layout),z.render(r.value,d)}};return I(()=>{u(),window.addEventListener("resize",u)}),O(()=>u()),P(()=>window.removeEventListener("resize",u)),()=>{let a={...s};return typeof e.layout=="string"&&(a.layout=e.layout),typeof e["layout-sm"]=="string"&&(a["layout-sm"]=e["layout-sm"]),k("div",{ref:r,style:{display:"grid",width:"100%",height:"100%"},...a},i.default?i.default():[])}}});export{F as Layout};
