import{useRef as k,useEffect as $}from"react";function j(t){let i={t:0,r:0,b:0,l:0};return t.forEach(s=>{let a=s.match(/^([trbl])(\d+)$/);a&&(i[a[1]]+=parseInt(a[2],10))}),i}var S=class t{constructor(i,s="leaf",a=[]){this.size=i;this.type=s;this.children=a;this.isSkippedSelf=!1;this.offsetIndices=[];this.styles={};this.spreadData={t:0,r:0,b:0,l:0};this.childPropRules=[];this.childSpreadRules=[]}col(...i){return new t(this.size,"col",i)}row(...i){return new t(this.size,"row",i)}offset(i){return Array.isArray(i)?this.offsetIndices=i:this.isSkippedSelf=!0,this}props(i){return this.styles={...this.styles,...i},this}childProps(i,s){return this.childPropRules.push({data:i,indices:s||null}),this}spread(i,s){let a=j(i);return s?this.childSpreadRules.push({data:a,indices:s}):(this.spreadData.t+=a.t,this.spreadData.r+=a.r,this.spreadData.b+=a.b,this.spreadData.l+=a.l),this}},D=class{constructor(i,s,a,d,n,c,b,y={t:0,r:0,b:0,l:0}){this.x=i;this.y=s;this.w=a;this.h=d;this.styles=n;this.isSkipped=c;this.customSize=b;this.spreadData=y}},z=!1;function v(){if(z)return;z=!0;let t=s=>new S(s),i=(s,a=!1)=>{if(s.col)return;let d=n=>t(a?String(n):n);s.col=function(...n){return new S(a?String(this):this,"col",n)},s.row=function(...n){return new S(a?String(this):this,"row",n)},s.offset=function(n){return d(this).offset(n)},s.props=function(n){return d(this).props(n)},s.childProps=function(n,c){return d(this).childProps(n,c)},s.spread=function(n,c){return d(this).spread(n,c)}};i(Number.prototype,!1),i(String.prototype,!0)}var A={bps:{sm:576,md:768,lg:992,xl:1200,xxl:1400},_strMap:new Map,_strCounter:0,init(){v(),this.upd(),typeof window<"u"&&window.addEventListener("resize",()=>this.upd())},upd(){typeof document<"u"&&document.querySelectorAll("[layout]").forEach(t=>this.render(t))},evalLayout(t){if(t)try{return new Function("lg","sm","Grid","auto","return "+t)(61.8,38.2,100,"auto")}catch(i){console.error(`Layout Error: "${t}"`,i);return}},isNode(t){return t&&typeof t=="object"&&Array.isArray(t.children)&&(t.type==="col"||t.type==="row"||t.type==="leaf")},render(t,i){v();let s=i;if(!s){let e=window.innerWidth,r=["xxl","xl","lg","md","sm"],l=t.getAttribute("layout");for(let f of r)if(e>=this.bps[f]&&t.hasAttribute(`layout-${f}`)){l=t.getAttribute(`layout-${f}`);break}l&&(s=this.evalLayout(l))}if(!s)return;if(s.styles){let{className:e,class:r,...l}=s.styles;e&&t.classList.add(...e.split(" ")),r&&t.classList.add(...r.split(" ")),Object.assign(t.style,l)}let a=[];this.calc(s,0,0,100,100,a,!1,[],[],[],{val:0});let{cw:d,rh:n,xc:c,yc:b}=this.mesh(a);t.style.display="grid",t.style.gridTemplateColumns=d.join(" "),t.style.gridTemplateRows=n.join(" ");let y=Array.from(t.children);y.forEach((e,r)=>{e.style.gridColumn="",e.style.gridRow="",e.style.cssText=""});let o=0;a.forEach(e=>{if(e.isSkipped||!y[o])return;let r=y[o++],l=this.idx(c,e.x)+1,f=this.idx(c,e.x+e.w)+1,h=this.idx(b,e.y)+1,g=this.idx(b,e.y+e.h)+1;if(e.spreadData&&(l=Math.max(1,l-e.spreadData.l),h=Math.max(1,h-e.spreadData.t),f+=e.spreadData.r,g+=e.spreadData.b),r.style.gridColumn=`${l} / ${f}`,r.style.gridRow=`${h} / ${g}`,e.styles){let{className:x,class:w,...L}=e.styles;x&&r.classList.add(...x.split(" ")),w&&r.classList.add(...w.split(" ")),Object.assign(r.style,L)}})},calc(t,i,s,a,d,n,c,b,y,o,e){if(!t)return;(typeof t=="number"||t==="auto")&&(t=new S(t==="auto"?"auto":t,"leaf"));let r=this.isNode(t),l=c||r&&t.isSkippedSelf,f=[...b],h=[...y],g=[...o];r&&(t.offsetIndices?.length&&f.push({idx:t.offsetIndices,c:0}),t.childPropRules.length&&t.childPropRules.forEach(p=>h.push({rule:p,counter:{val:0}})),t.childSpreadRules.length&&t.childSpreadRules.forEach(p=>g.push({rule:p,counter:{val:0}})));let x;if(r&&typeof t.size=="string"&&(x=t.size),!r||!t.children.length){let p=l;for(let u=0;u<f.length;u++)f[u].c++,f[u].idx.includes(f[u].c)&&(p=!0);p||(e.val++,h.forEach(u=>u.counter.val++),g.forEach(u=>u.counter.val++));let m=r?{...t.spreadData}:{t:0,r:0,b:0,l:0},N=r?{...t.styles}:{};p||(g.forEach(u=>{(!u.rule.indices||u.rule.indices.includes(u.counter.val))&&(m.t+=u.rule.data.t,m.r+=u.rule.data.r,m.b+=u.rule.data.b,m.l+=u.rule.data.l)}),h.forEach(u=>{(!u.rule.indices||u.rule.indices.includes(u.counter.val))&&Object.assign(N,u.rule.data)})),n.push(new D(i,s,a,d,N,p,x,m));return}let w=0;t.children.forEach(p=>{let m=this.isNode(p)?p.size:p;typeof m=="string"?m=0:this.isNode(p)&&p.size===0&&(m=1),w+=Number(m)}),w===0&&(w=1);let L=t.type==="col"?i:s;t.children.forEach((p,m)=>{let N=this.isNode(p)?p.size:p,u=typeof N=="string",M=u?0:Number(N);this.isNode(p)&&p.size===0&&!u&&(M=1);let T=M/w,R=0;if(u&&(this._strCounter++,R=1e-6+this._strCounter*1e-7,this._strMap.set(R.toFixed(9),N)),t.type==="col"){let E=u?R:a*T;this.calc(p,L,s,E,d,n,l,f,h,g,e),L+=E}else{let E=u?R:d*T;this.calc(p,i,L,a,E,n,l,f,h,g,e),L+=E}})},mesh(t){this._strCounter=0;let i=[0],s=[0],a=0,d=0;t.forEach(o=>{i.push(o.x,o.x+o.w),s.push(o.y,o.y+o.h),o.x+o.w>a&&(a=o.x+o.w),o.y+o.h>d&&(d=o.y+o.h)}),a>1&&i.push(100),d>1&&s.push(100);let n=o=>[...new Set(o.sort((e,r)=>e-r))].filter((e,r,l)=>r===0||Math.abs(e-l[r-1])>1e-8),c=n(i),b=n(s),y=o=>{let e=[];for(let r=1;r<o.length;r++){let l=o[r]-o[r-1],f=null;for(let[h,g]of this._strMap){let x=Number(h);if(Math.abs(l-x)<1e-8){f=g;break}}e.push(f||l+"fr")}return e};return{xc:c,yc:b,cw:y(c),rh:y(b)}},idx(t,i){let s=-1,a=1/0;return t.forEach((d,n)=>{let c=Math.abs(d-i);c<a&&(a=c,s=n)}),s},compileCSS(t){let i=this.evalLayout(t);if(!i)return null;let s=[];this.calc(i,0,0,100,100,s,!1,[],[],[],{val:0});let{cw:a,rh:d,xc:n,yc:c}=this.mesh(s),b=`display: grid; grid-template-columns: ${a.join(" ")}; grid-template-rows: ${d.join(" ")};`,y="",o=1;for(let e of s){if(e.isSkipped)continue;let r=this.idx(n,e.x)+1,l=this.idx(n,e.x+e.w)+1,f=this.idx(c,e.y)+1,h=this.idx(c,e.y+e.h)+1;e.spreadData&&(r=Math.max(1,r-e.spreadData.l),f=Math.max(1,f-e.spreadData.t),l+=e.spreadData.r,h+=e.spreadData.b),y+=`
  & > :nth-child(${o++}) { grid-area: ${f} / ${r} / ${h} / ${l}; }`}return b+y}};import{jsx as C}from"react/jsx-runtime";typeof window<"u"&&v();var G=100,U=61.8,Z=38.2,q="auto",Y=({children:t,layout:i,"layout-sm":s,"layout-md":a,"layout-lg":d,"layout-xl":n,"layout-xxl":c,...b})=>{let y=k(null),o=()=>{if(typeof window>"u")return;let l=window.innerWidth;if(l>=1400&&typeof c=="object")return c;if(l>=1200&&typeof n=="object")return n;if(l>=992&&typeof d=="object")return d;if(l>=768&&typeof a=="object")return a;if(l>=576&&typeof s=="object")return s;if(typeof i=="object")return i},e=()=>{y.current&&A.render(y.current,o())};$(()=>{e()}),$(()=>(window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)),[i,s,a,d,n,c]);let r={...b};return typeof i=="string"&&(r.layout=i),typeof s=="string"&&(r["layout-sm"]=s),typeof a=="string"&&(r["layout-md"]=a),typeof d=="string"&&(r["layout-lg"]=d),typeof n=="string"&&(r["layout-xl"]=n),C("div",{ref:y,...r,style:{display:"grid",width:"100%",height:"100%",...b.style},children:t})};export{G as Grid,Y as Layout,q as auto,U as lg,Z as sm};
