function A(e){let i={t:0,r:0,b:0,l:0};return e.forEach(s=>{let r=s.match(/^([trbl])(\d+)$/);r&&(i[r[1]]+=parseInt(r[2],10))}),i}var L=class e{constructor(i,s="leaf",r=[]){this.size=i;this.type=s;this.children=r;this.isSkippedSelf=!1;this.offsetIndices=[];this.styles={};this.spreadData={t:0,r:0,b:0,l:0};this.childPropRules=[];this.childSpreadRules=[]}col(...i){return new e(this.size,"col",i)}row(...i){return new e(this.size,"row",i)}offset(i){return Array.isArray(i)?this.offsetIndices=i:this.isSkippedSelf=!0,this}props(i){return this.styles={...this.styles,...i},this}childProps(i,s){return this.childPropRules.push({data:i,indices:s||null}),this}spread(i,s){let r=A(i);return s?this.childSpreadRules.push({data:r,indices:s}):(this.spreadData.t+=r.t,this.spreadData.r+=r.r,this.spreadData.b+=r.b,this.spreadData.l+=r.l),this}},M=class{constructor(i,s,r,p,n,f,m,y={t:0,r:0,b:0,l:0}){this.x=i;this.y=s;this.w=r;this.h=p;this.styles=n;this.isSkipped=f;this.customSize=m;this.spreadData=y}},z=!1;function R(){if(z)return;z=!0;let e=s=>new L(s),i=(s,r=!1)=>{if(s.col)return;let p=n=>e(r?String(n):n);s.col=function(...n){return new L(r?String(this):this,"col",n)},s.row=function(...n){return new L(r?String(this):this,"row",n)},s.offset=function(n){return p(this).offset(n)},s.props=function(n){return p(this).props(n)},s.childProps=function(n,f){return p(this).childProps(n,f)},s.spread=function(n,f){return p(this).spread(n,f)}};i(Number.prototype,!1),i(String.prototype,!0)}var T={bps:{sm:576,md:768,lg:992,xl:1200,xxl:1400},_strMap:new Map,_strCounter:0,init(){R(),this.upd(),typeof window<"u"&&window.addEventListener("resize",()=>this.upd())},upd(){typeof document<"u"&&document.querySelectorAll("[layout]").forEach(e=>this.render(e))},evalLayout(e){if(e)try{return new Function("lg","sm","Grid","auto","return "+e)(61.8,38.2,100,"auto")}catch(i){console.error(`Layout Error: "${e}"`,i);return}},isNode(e){return e&&typeof e=="object"&&Array.isArray(e.children)&&(e.type==="col"||e.type==="row"||e.type==="leaf")},render(e,i){R();let s=i;if(!s){let t=window.innerWidth,a=["xxl","xl","lg","md","sm"],c=e.getAttribute("layout");for(let u of a)if(t>=this.bps[u]&&e.hasAttribute(`layout-${u}`)){c=e.getAttribute(`layout-${u}`);break}c&&(s=this.evalLayout(c))}if(!s)return;if(s.styles){let{className:t,class:a,...c}=s.styles;t&&e.classList.add(...t.split(" ")),a&&e.classList.add(...a.split(" ")),Object.assign(e.style,c)}let r=[];this.calc(s,0,0,100,100,r,!1,[],[],[],{val:0});let{cw:p,rh:n,xc:f,yc:m}=this.mesh(r);e.style.display="grid",e.style.gridTemplateColumns=p.join(" "),e.style.gridTemplateRows=n.join(" ");let y=Array.from(e.children);y.forEach((t,a)=>{t.style.gridColumn="",t.style.gridRow="",t.style.cssText=""});let o=0;r.forEach(t=>{if(t.isSkipped||!y[o])return;let a=y[o++],c=this.idx(f,t.x)+1,u=this.idx(f,t.x+t.w)+1,h=this.idx(m,t.y)+1,g=this.idx(m,t.y+t.h)+1;if(t.spreadData&&(c=Math.max(1,c-t.spreadData.l),h=Math.max(1,h-t.spreadData.t),u+=t.spreadData.r,g+=t.spreadData.b),a.style.gridColumn=`${c} / ${u}`,a.style.gridRow=`${h} / ${g}`,t.styles){let{className:x,class:S,...w}=t.styles;x&&a.classList.add(...x.split(" ")),S&&a.classList.add(...S.split(" ")),Object.assign(a.style,w)}})},calc(e,i,s,r,p,n,f,m,y,o,t){if(!e)return;(typeof e=="number"||e==="auto")&&(e=new L(e==="auto"?"auto":e,"leaf"));let a=this.isNode(e),c=f||a&&e.isSkippedSelf,u=[...m],h=[...y],g=[...o];a&&(e.offsetIndices?.length&&u.push({idx:e.offsetIndices,c:0}),e.childPropRules.length&&e.childPropRules.forEach(d=>h.push({rule:d,counter:{val:0}})),e.childSpreadRules.length&&e.childSpreadRules.forEach(d=>g.push({rule:d,counter:{val:0}})));let x;if(a&&typeof e.size=="string"&&(x=e.size),!a||!e.children.length){let d=c;for(let l=0;l<u.length;l++)u[l].c++,u[l].idx.includes(u[l].c)&&(d=!0);d||(t.val++,h.forEach(l=>l.counter.val++),g.forEach(l=>l.counter.val++));let b=a?{...e.spreadData}:{t:0,r:0,b:0,l:0},N=a?{...e.styles}:{};d||(g.forEach(l=>{(!l.rule.indices||l.rule.indices.includes(l.counter.val))&&(b.t+=l.rule.data.t,b.r+=l.rule.data.r,b.b+=l.rule.data.b,b.l+=l.rule.data.l)}),h.forEach(l=>{(!l.rule.indices||l.rule.indices.includes(l.counter.val))&&Object.assign(N,l.rule.data)})),n.push(new M(i,s,r,p,N,d,x,b));return}let S=0;e.children.forEach(d=>{let b=this.isNode(d)?d.size:d;typeof b=="string"?b=0:this.isNode(d)&&d.size===0&&(b=1),S+=Number(b)}),S===0&&(S=1);let w=e.type==="col"?i:s;e.children.forEach((d,b)=>{let N=this.isNode(d)?d.size:d,l=typeof N=="string",v=l?0:Number(N);this.isNode(d)&&d.size===0&&!l&&(v=1);let $=v/S,D=0;if(l&&(this._strCounter++,D=1e-6+this._strCounter*1e-7,this._strMap.set(D.toFixed(9),N)),e.type==="col"){let E=l?D:r*$;this.calc(d,w,s,E,p,n,c,u,h,g,t),w+=E}else{let E=l?D:p*$;this.calc(d,i,w,r,E,n,c,u,h,g,t),w+=E}})},mesh(e){this._strCounter=0;let i=[0],s=[0],r=0,p=0;e.forEach(o=>{i.push(o.x,o.x+o.w),s.push(o.y,o.y+o.h),o.x+o.w>r&&(r=o.x+o.w),o.y+o.h>p&&(p=o.y+o.h)}),r>1&&i.push(100),p>1&&s.push(100);let n=o=>[...new Set(o.sort((t,a)=>t-a))].filter((t,a,c)=>a===0||Math.abs(t-c[a-1])>1e-8),f=n(i),m=n(s),y=o=>{let t=[];for(let a=1;a<o.length;a++){let c=o[a]-o[a-1],u=null;for(let[h,g]of this._strMap){let x=Number(h);if(Math.abs(c-x)<1e-8){u=g;break}}t.push(u||c+"fr")}return t};return{xc:f,yc:m,cw:y(f),rh:y(m)}},idx(e,i){let s=-1,r=1/0;return e.forEach((p,n)=>{let f=Math.abs(p-i);f<r&&(r=f,s=n)}),s},compileCSS(e){let i=this.evalLayout(e);if(!i)return null;let s=[];this.calc(i,0,0,100,100,s,!1,[],[],[],{val:0});let{cw:r,rh:p,xc:n,yc:f}=this.mesh(s),m=`display: grid; grid-template-columns: ${r.join(" ")}; grid-template-rows: ${p.join(" ")};`,y="",o=1;for(let t of s){if(t.isSkipped)continue;let a=this.idx(n,t.x)+1,c=this.idx(n,t.x+t.w)+1,u=this.idx(f,t.y)+1,h=this.idx(f,t.y+t.h)+1;t.spreadData&&(a=Math.max(1,a-t.spreadData.l),u=Math.max(1,u-t.spreadData.t),c+=t.spreadData.r,h+=t.spreadData.b),y+=`
  & > :nth-child(${o++}) { grid-area: ${u} / ${a} / ${h} / ${c}; }`}return m+y}};var C=100,j=61.8,_=38.2,O="auto";typeof window<"u"&&R();export{T as Engine,C as Grid,L as LayoutNode,M as Rect,O as auto,R as installExtensions,j as lg,_ as sm};
