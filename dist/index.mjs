function _(e){return{t:e.top||0,r:e.right||0,b:e.bottom||0,l:e.left||0}}function v(e,t,s){if(e instanceof x||typeof e!="object"||e===null)return e;let i=e,a=Object.keys(i).sort((u,f)=>(s[f]||0)-(s[u]||0));for(let u of a)if(t>=(s[u]||0))return i[u];return i.xs??i.default??1}function $(e,t){if(!t)return;let{className:s,class:i,...a}=t;s&&e.classList.add(...String(s).split(" ")),i&&e.classList.add(...String(i).split(" ")),Object.assign(e.style,a)}var x=class e{constructor(t,s="leaf",i=[]){this.size=t;this.type=s;this.children=i;this.isSkippedSelf=!1;this.offsetIndices=[];this.styles={};this.spanData={t:0,r:0,b:0,l:0};this.childPropRules=[];this.childSpanRules=[]}col(...t){return new e(this.size,"col",t)}row(...t){return new e(this.size,"row",t)}offset(t){return Array.isArray(t)?this.offsetIndices=t:this.isSkippedSelf=!0,this}props(t){return this.styles={...this.styles,...t},this}childProps(t,s){return this.childPropRules.push({data:t,indices:s||null}),this}span(t,s){let i=_(t);return s?this.childSpanRules.push({data:i,indices:s}):(this.spanData.t+=i.t,this.spanData.r+=i.r,this.spanData.b+=i.b,this.spanData.l+=i.l),this}},z=class{constructor(t,s,i,a,u,f,m,b={t:0,r:0,b:0,l:0}){this.x=t;this.y=s;this.w=i;this.h=a;this.styles=u;this.isSkipped=f;this.customSize=m;this.spanData=b}},j=!1;function I(){if(j)return;j=!0;let e=(t,s=!1)=>{if(t.col)return;let i=a=>new x(s?String(a):a);t.col=function(...a){return new x(s?String(this):this,"col",a)},t.row=function(...a){return new x(s?String(this):this,"row",a)},t.offset=function(a){return i(this).offset(a)},t.props=function(a){return i(this).props(a)},t.childProps=function(a,u){return i(this).childProps(a,u)},t.span=function(a,u){return i(this).span(a,u)}};e(Number.prototype,!1),e(String.prototype,!0)}var P={bps:{xs:0,sm:576,md:768,lg:992,xl:1200,xxl:1400},_strMap:new Map,_strCounter:0,init(){I(),this.upd(),typeof window<"u"&&window.addEventListener("resize",()=>this.upd())},upd(){typeof document<"u"&&document.querySelectorAll("[layout]").forEach(e=>this.render(e))},evalLayout(e){if(e)try{return new Function("lg","sm","Grid","auto","none","return "+e)(61.8,38.2,100,"auto","none")}catch{return}},isNode(e){return e&&typeof e=="object"&&Array.isArray(e.children)},render(e,t){I();let s=typeof window<"u"?window.innerWidth:0,i=t;if(!i){let n=s>=1400&&e.getAttribute("layout-xxl")||s>=1200&&e.getAttribute("layout-xl")||s>=992&&e.getAttribute("layout-lg")||s>=768&&e.getAttribute("layout-md")||s>=576&&e.getAttribute("layout-sm")||e.getAttribute("layout");n&&(i=this.evalLayout(n))}if(!i)return;$(e,i.styles);let a=[];this.calc(i,0,0,100,100,a,!1,[],[],[],{val:0},s,{t:0,r:0,b:0,l:0});let{cw:u,rh:f,xc:m,yc:b}=this.mesh(a);e.style.display="grid",e.style.gridTemplateColumns=u.join(" "),e.style.gridTemplateRows=f.join(" ");let p=Array.from(e.children);p.forEach(n=>{n.style.gridArea="",n.style.display=""});let o=0;a.forEach(n=>{if(n.isSkipped)return;let y=p[o++];if(!y)return;if(n.styles?.display==="none"){y.style.display="none";return}let h=this.idx(m,n.x)+1,r=this.idx(m,n.x+n.w)+1,g=this.idx(b,n.y)+1,L=this.idx(b,n.y+n.h)+1;n.spanData&&(h=Math.max(1,h-n.spanData.l),g=Math.max(1,g-n.spanData.t),r+=n.spanData.r,L+=n.spanData.b),y.style.gridColumn=`${h} / ${r}`,y.style.gridRow=`${g} / ${L}`,$(y,n.styles)})},calc(e,t,s,i,a,u,f,m,b,p,o,n,y){if(e==null)return;let h=v(e,n,this.bps),r;this.isNode(h)?(r=h,r.size=v(r.size,n,this.bps)):r=new x(h,"leaf");let g=this.isNode(r),L=f||r.isSkippedSelf,D=[...m];g&&r.offsetIndices?.length&&D.push({idx:r.offsetIndices,c:0});let w={...y};g&&(w.t+=r.spanData.t,w.r+=r.spanData.r,w.b+=r.spanData.b,w.l+=r.spanData.l);let N=[...b],M=[...p];if(r.childPropRules.length&&r.childPropRules.forEach(l=>N.push({rule:l,counter:{val:0}})),r.childSpanRules.length&&r.childSpanRules.forEach(l=>M.push({rule:l,counter:{val:0}})),r.type==="leaf"||!r.children.length){let l=L;D.forEach(c=>{c.c++,c.idx.includes(c.c)&&(l=!0)}),l||(o.val++,N.forEach(c=>c.counter.val++),M.forEach(c=>c.counter.val++));let d={...w};l||M.forEach(c=>{(!c.rule.indices||c.rule.indices.includes(c.counter.val))&&(d.t+=c.rule.data.t,d.r+=c.rule.data.r,d.b+=c.rule.data.b,d.l+=c.rule.data.l)});let S={...r.styles};r.size==="none"&&(S.display="none"),l||N.forEach(c=>{(!c.rule.indices||c.rule.indices.includes(c.counter.val))&&Object.assign(S,c.rule.data)}),u.push(new z(t,s,i,a,S,l,typeof r.size=="string"?r.size:void 0,d));return}let E=0,A=r.children.map(l=>{let d=v(l,n,this.bps);return this.isNode(d)&&(d.size=v(d.size,n,this.bps)),d});A.forEach(l=>{let d=this.isNode(l)?l.size:l;d==="none"||typeof d=="string"?d=0:this.isNode(l)&&l.size===0&&(d=1),E+=Number(d)}),E===0&&(E=1);let T=r.type==="col"?t:s;A.forEach(l=>{let d=this.isNode(l)?l.size:l,S=typeof d=="string",c=S?0:Number(d);this.isNode(l)&&l.size===0&&!S&&(c=1);let C=c/E,k=0;if(S&&d!=="none"&&(this._strCounter++,k=1e-6+this._strCounter*1e-7,this._strMap.set(k.toFixed(9),d)),r.type==="col"){let R=S?k:i*C;this.calc(l,T,s,R,a,u,L,D,N,M,o,n,{t:0,r:0,b:0,l:0}),T+=R}else{let R=S?k:a*C;this.calc(l,t,T,i,R,u,L,D,N,M,o,n,{t:0,r:0,b:0,l:0}),T+=R}})},mesh(e){this._strCounter=0;let t=[0],s=[0],i=0,a=0;e.forEach(p=>{t.push(p.x,p.x+p.w),s.push(p.y,p.y+p.h),i=Math.max(i,p.x+p.w),a=Math.max(a,p.y+p.h)}),i>1&&t.push(100),a>1&&s.push(100);let u=p=>[...new Set(p.sort((o,n)=>o-n))].filter((o,n,y)=>n===0||Math.abs(o-y[n-1])>1e-8),f=u(t),m=u(s),b=p=>{let o=[];for(let n=1;n<p.length;n++){let y=p[n]-p[n-1],h=null;for(let[r,g]of this._strMap)if(Math.abs(y-Number(r))<1e-8){h=g;break}o.push(h||y/10+"fr")}return o};return{xc:f,yc:m,cw:b(f),rh:b(m)}},idx(e,t){let s=-1,i=1/0;return e.forEach((a,u)=>{let f=Math.abs(a-t);f<i&&(i=f,s=u)}),s},compileCSS(e){let t=this.evalLayout(e);if(!t)return null;let s=[];this.calc(t,0,0,100,100,s,!1,[],[],[],{val:0},1200,{t:0,r:0,b:0,l:0});let{cw:i,rh:a,xc:u,yc:f}=this.mesh(s),m=`display: grid; grid-template-columns: ${i.join(" ")}; grid-template-rows: ${a.join(" ")};`,b="",p=1;for(let o of s){if(o.isSkipped)continue;let n=this.idx(u,o.x)+1,y=this.idx(u,o.x+o.w)+1,h=this.idx(f,o.y)+1,r=this.idx(f,o.y+o.h)+1;o.spanData&&(n=Math.max(1,n-o.spanData.l),h=Math.max(1,h-o.spanData.t),y+=o.spanData.r,r+=o.spanData.b),b+=`
  & > :nth-child(${p++}) { grid-area: ${h} / ${n} / ${r} / ${y};${o.styles?.display==="none"?" display: none;":""} }`}return m+b}};var H=100,B=61.8,F=38.2,G="auto";typeof window<"u"&&I();export{P as Engine,H as Grid,x as LayoutNode,z as Rect,G as auto,I as installExtensions,B as lg,F as sm};
